<!--
  @description       : 
  @author            : Abhinav Singh
  @group             : 
  @last modified on  : 08-03-2025
  @last modified by  : Abhinav Singh
-->
<template>
    <div class="slds-var-p-around_medium questionnaire-container">
        <!-- Debug Info -->
        <div class="slds-box slds-theme_info slds-var-m-bottom_medium">
            <h3>Debug Info:</h3>
            <p>Questions Length: {questions.length}</p>
            <p>Show Questionnaire: {showQuestionnaire}</p>
            <p>Current Question Index: {currentQuestionIndex}</p>
            <p>Loading: {loading}</p>
            <p>Error: {error}</p>
        </div>

        <!-- Loading State -->
        <template if:true={loading}>
            <div class="slds-is-relative slds-var-p-around_large">
                <lightning-spinner alternative-text="Loading questionnaire..." size="medium"></lightning-spinner>
            </div>
        </template>

        <!-- Error State -->
        <template if:true={error}>
            <div
                class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error slds-var-m-bottom_medium">
                <span class="slds-assistive-text">error</span>
                <h2>
                    <lightning-icon icon-name="utility:error" size="small"
                        class="slds-var-m-right_x-small"></lightning-icon>
                    {error}
                </h2>
            </div>
        </template>

        <!-- Start Button -->
        <template if:true={shouldShowStartButton}>
            <div class="slds-box slds-theme_default slds-text-align_center">
                <lightning-icon icon-name="standard:survey" size="large"
                    class="slds-var-m-bottom_medium"></lightning-icon>
                <h1 class="slds-text-heading_large slds-var-m-bottom_medium">Mental Wellness Assessment</h1>
                <p class="slds-text-body_regular slds-var-m-bottom_large">
                    Take a few minutes to complete this assessment and get personalized insights about your mental
                    wellness.
                </p>
                <lightning-button variant="brand" label="Start Assessment" onclick={handleStartQuestionnaire}
                    class="slds-var-m-top_medium">
                </lightning-button>
            </div>
        </template>

        <!-- Questionnaire -->
        <template if:true={showQuestionnaire}>
            <div class="slds-box slds-theme_default">
                <!-- Progress Bar -->
                <div class="slds-var-m-bottom_medium">
                    <div class="slds-progress-bar" aria-valuemin="0" aria-valuemax="100"
                        aria-valuenow={progressPercentage} role="progressbar">
                        <span class="slds-progress-bar__value" style={progressBarStyle}></span>
                    </div>
                    <div class="slds-text-body_small slds-var-m-top_x-small">
                        Question {currentQuestionIndexPlusOne} of {questions.length}
                    </div>
                </div>

                <!-- Current Question -->
                <template if:true={currentQuestion}>
                    <div class="slds-var-m-bottom_large">
                        <h2 class="slds-text-heading_medium slds-var-m-bottom_medium">
                            {currentQuestion.text}
                            <span class="slds-text-color_error">*</span>
                        </h2>

                        <!-- Question Type: Multiple Choice -->
                        <template if:true={currentQuestion.isMultipleChoice}>
                            <lightning-radio-group name={currentQuestion.id} options={currentOptions}
                                value={currentAnswer} type="radio" onchange={handleGroupChange}>
                            </lightning-radio-group>
                        </template>

                        <!-- Question Type: Multiple Select -->
                        <template if:true={currentQuestion.isMultipleSelect}>
                            <lightning-checkbox-group name={currentQuestion.id} options={currentOptions}
                                value={currentAnswerArray} onchange={handleGroupChange}>
                            </lightning-checkbox-group>
                        </template>

                        <!-- Question Type: Text -->
                        <template if:true={currentQuestion.isText}>
                            <lightning-textarea name={currentQuestion.id} label="Your answer:"
                                placeholder="Please provide your response..." value={getCurrentAnswer}
                                onchange={handleAnswerChange}>
                            </lightning-textarea>
                        </template>

                        <!-- Question Type: Scale -->
                        <template if:true={currentQuestion.isScale}>
                            <div class="slds-form-element">
                                <label class="slds-form-element__label">Rate on a scale of 1-10:</label>
                                <div class="slds-form-element__control">
                                    <lightning-slider name={currentQuestion.id} min="1" max="10" step="1"
                                        value={getCurrentAnswer} onchange={handleAnswerChange}>
                                    </lightning-slider>
                                </div>
                            </div>
                        </template>

                        <!-- Question Type: Yes/No -->
                        <template if:true={currentQuestion.isYesNo}>
                            <lightning-radio-group name={currentQuestion.id} options={yesNoOptions}
                                value={currentAnswer} type="radio" onchange={handleGroupChange}>
                            </lightning-radio-group>
                        </template>

                        <!-- Show current answer if exists -->
                        <template if:true={hasPreviousAnswer}>
                            <div class="slds-box slds-theme_info slds-var-m-top_medium">
                                <h3 class="slds-text-heading_small slds-var-m-bottom_x-small">Your previous answer:</h3>
                                <p class="slds-text-body_regular">{getCurrentAnswer}</p>
                            </div>
                        </template>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="slds-grid slds-grid_align-spread">
                        <div>
                            <lightning-button if:true={currentQuestionIndex} variant="neutral" label="Previous"
                                onclick={handlePrevious}>
                            </lightning-button>
                        </div>
                        <div>
                            <template if:true={isLastQuestion}>
                                <lightning-button variant="brand" label="Submit" onclick={handleSubmit}>
                                </lightning-button>
                            </template>
                            <template if:false={isLastQuestion}>
                                <lightning-button variant="brand" label="Next" onclick={handleNext}>
                                </lightning-button>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </template>

        <!-- Already Completed Message -->
        <template if:true={questionnaireCompleted}>
            <div class="slds-box slds-theme_default slds-text-align_center">
                <lightning-icon icon-name="utility:check" size="large"
                    class="slds-text-color_success slds-var-m-bottom_medium"></lightning-icon>
                <h2 class="slds-text-heading_medium slds-var-m-bottom_medium">Assessment Completed</h2>
                <p class="slds-text-body_regular">
                    You have already completed this assessment. Thank you for participating!
                </p>
            </div>
        </template>
    </div>
</template>